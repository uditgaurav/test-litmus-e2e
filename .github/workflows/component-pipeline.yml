---
name: Build
on:
  push:
    branches: [master]
    
jobs:
  component-pipeline:
    runs-on: ubuntu-latest
    steps:
      - name: Connect to the Kubernetes Cluster
        run: | 
          mkdir -p /home/runner/.kube/
          echo "$KUBE_CONFIG_DATA" > /home/runner/.kube/config
        env:
          KUBE_CONFIG_DATA: ${{ secrets.KUBE_CONFIG_DATA }}
          
      - name: Getting the nodes
        env:
          KUBECONFIG: /home/runner/.kube/config 
        run: |
          curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
          sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
          kubectl version --client
          kubectl config view
          kubectl config use-context kubernetes-admin@kubernetes
          kubectl get nodes

          
#       - name: Setting up kubeconfig ENV for Github Chaos Action
#         run: echo ::set-env name=KUBE_CONFIG_DATA::$(base64 -w 0 ~/.kube/config)
#         env:
#           ACTIONS_ALLOW_UNSECURE_COMMANDS: true          
        
          
#       - name: Get nodes of the cluster
#         env:
#           KUBECONFIG: ${{ secrets.KUBE_CONFIG_DATA }}      
#         run: kubectl get nodes
        
        
